{% extends "base.html" %}
{% load humanize %}
{% load django_tables2 %}
{% block title %}Finance - Solinor{% endblock %}

{% block pageJs %}
$.get("{% url "your_stats" %}", function(data) {
  if (data.your_unsubmitted_entries > 0) {
    $("#your_unsubmitted_entries").addClass("text-danger");
    $("#your_unsubmitted_entries").html(data.your_unsubmitted_entries + " <span class='glyphicon glyphicon-exclamation-sign'></span>");
  } else {
    $("#your_unsubmitted_entries").html(data.your_unsubmitted_entries + " <span class='glyphicon glyphicon-ok-sign'>");
  }
  $("#your_last_hour_marking").html(data.your_last_hour_marking + " (" + data.your_last_hour_marking_day + ")");
  if (typeof data.your_hours_this_week === "number") {
    $("#your_hours_this_week").html(data.your_hours_this_week.toFixed(2) + "h");
  } else {
    $("#your_hours_this_week").html("?");
  }
  if (typeof data.your_billing_ratio === "number") {
    $("#your_billing_ratio").html(data.your_billing_ratio.toFixed(0) + "%");
  } else {
    $("#your_billing_ratio").html("?");
  }
  $("#your_billing_ratio_sparkline").sparkline(data.your_daily_billing_ratio, {"disableTooltips": true});
})
$.get("{% url "frontpage_invoice_table" %}" + window.location.search, function(data) {
  $("#all-invoices-table").html(data);
}, "html");
{% endblock %}
{% block content %}

<div class="row">
  <div class="col-md-3 clickable-area" onclick="Turbolinks.visit('{% url "your_unsubmitted_hours" %}');">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Unsubmitted entries</h5>
        <p class="lead" id="your_unsubmitted_entries">Loading</p>
        </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Last hour marking</h5>
        <p class="lead" id="your_last_hour_marking">Loading</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Hours for past 7 days</h3>
        <p class="lead" id="your_hours_this_week">Loading</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Your billing rate <small>Past 30d</small></h3>
        <p class="lead"><span id="your_billing_ratio">Loading</span> <span id="your_billing_ratio_sparkline"></span></p>
      </div>
    </div>
  </div>
</div>


{% if your_invoices %}
<h2>Your projects</h2>

{% include "snippets/frontpage_table.html" with invoices=your_invoices %}

{% endif %}

<div id="all-invoices-table"><h2>Loading...</h2></div>

{% endblock %}
