{% extends "base.html" %}
{% load humanize %}
{% load django_tables2 %}
{% block title %}Finance - Solinor{% endblock %}

{% block pageJs %}
$.get("{% url "your_stats" %}", function(data) {
  if (data.your_unsubmitted_entries > 0) {
    $("#your_unsubmitted_entries").addClass("text-danger");
    $("#your_unsubmitted_entries").html(data.your_unsubmitted_entries + " <i class='fa fa-exclamation-circle'></i>");
  } else {
    $("#your_unsubmitted_entries").html(data.your_unsubmitted_entries + " <i class='fa fa-check-circle'></i>");
  }
  $("#your_last_hour_marking").html(data.your_last_hour_marking + " (" + data.your_last_hour_marking_day + ")");
  if (typeof data.your_hours_this_week === "number") {
    $("#your_hours_this_week").html(data.your_hours_this_week.toFixed(2) + "h");
  } else {
    $("#your_hours_this_week").html("?");
  }
  if (typeof data.your_billing_ratio === "number") {
    $("#your_billing_ratio").html(data.your_billing_ratio.toFixed(0) + "%");
  } else {
    $("#your_billing_ratio").html("?");
  }
  $("#your_billing_ratio_sparkline").sparkline(data.your_daily_billing_ratio, {"disableTooltips": true});
})
$.get("{% url "frontpage_invoice_table" %}" + window.location.search, function(data) {
  $("#all-invoices-table").html(data);
}, "html");
$(".sparkline-content").sparkline('html', {"width": "100%"});
{% endblock %}
{% block content %}

<div class="row">
  <div class="col-md-3 clickable-area" onclick="Turbolinks.visit('{% url "your_unsubmitted_hours" %}');">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Unsubmitted entries</h5>
        <p class="lead" id="your_unsubmitted_entries">Loading</p>
        </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Last hour marking</h5>
        <p class="lead" id="your_last_hour_marking">Loading</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Hours for past 7 days</h3>
        <p class="lead" id="your_hours_this_week">Loading</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Your billing rate <small>Past 30d</small></h3>
        <p class="lead"><span id="your_billing_ratio">Loading</span> <span id="your_billing_ratio_sparkline"></span></p>
      </div>
    </div>
  </div>
</div>

<div class="album py-5 bg-light">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <div class="card mb-4 box-shadow">
          <div class="card-header"><h5>Example project</h5></div>
          <div class="card-body">
            <p class="card-text">
              This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
              <div class="row">
                <div class="col-md-4">Billing</div>
                <div class="col-md-8"><span class="sparkline-content">1,2,3,4,6,2,3,4,1,2,5,2,3,3,3,3,4,5,6,5,4,5,6,1</span></div>
              </div>
              <div class="row">
                <div class="col-md-4">Hours</div>
                <div class="col-md-8"><span class="sparkline-content">1,2,3,4,6,2,3,4,1,2,5,2,3,3,5,70,1,1,80,80,70,90</span></div>
              </div>
              <div class="row">
                <div class="col-md-4">People</div>
                <div class="col-md-8"><span class="sparkline-content">2,3,4,6,2,3,4,1,2,5,2,3,3,3,3,4,5,6,5,4,5,6,1,3,1</span></div>
              </div>
              &nbsp;
            <div class="d-flex justify-content-between align-items-center">
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-secondary">View</button>
                <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button>
              </div>
              <small class="text-muted"></small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{% if your_invoices %}
<h2>Your projects</h2>

{% include "snippets/frontpage_table.html" with invoices=your_invoices %}

{% endif %}

<div id="all-invoices-table"><h2>Loading...</h2></div>

{% endblock %}
